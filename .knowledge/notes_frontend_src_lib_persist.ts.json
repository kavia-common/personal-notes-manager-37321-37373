{"is_source_file": true, "format": "TypeScript", "description": "This file implements a local storage-backed persistence layer for managing notes, including functions to read, write, normalize, create, update, delete, and synchronize notes stored in the browser's localStorage.", "external_files": ["./types"], "external_methods": ["createNote", "nowIso"], "published": ["listNotes", "getNote", "createNote", "updateNote", "deleteNote", "syncReplaceAll", "syncUpsert", "syncDelete", "persist"], "classes": [], "methods": [{"name": "function readAll(): Note[] { readAll", "description": "Reads and parses the list of notes from localStorage, returning an array of valid Note objects.", "scope": "", "scopeKind": ""}, {"name": "function writeAll(list: Note[]): void { writeAll", "description": "Serializes and saves the full list of notes to localStorage.", "scope": "", "scopeKind": ""}, {"name": "function normalizeNote(v: any): Note | null { normalizeNote", "description": "Validates and sanitizes an object to conform to the Note type, or returns null if invalid.", "scope": "", "scopeKind": ""}, {"name": "function genId(): string { genId", "description": "Generates a unique identifier for new notes, using crypto.randomUUID if available, or a fallback method.", "scope": "", "scopeKind": ""}, {"name": "function upsert(list: Note[], note: Note): Note[] { upsert", "description": "Inserts or replaces a note in the list based on its id.", "scope": "", "scopeKind": ""}, {"name": "function removeById(list: Note[], id: string): Note[] { removeById", "description": "Removes a note from the list by its id.", "scope": "", "scopeKind": ""}, {"name": "export function listNotes(): Note[] { listNotes", "description": "Returns all notes sorted by updatedAt in descending order.", "scope": "", "scopeKind": ""}, {"name": "export function getNote(id: NoteId): Note | null { getNote", "description": "Retrieves a single note by its id.", "scope": "", "scopeKind": ""}, {"name": "export function createNotePersist(input: NewNoteInput): Note { createNotePersist", "description": "Creates a new note with a generated id and timestamps, then persists and returns it.", "scope": "", "scopeKind": ""}, {"name": "export function updateNotePersist(input: UpdateNoteInput): Note { updateNotePersist", "description": "Updates an existing note's title and content, updating the timestamp, and persists it.", "scope": "", "scopeKind": ""}, {"name": "export function deleteNotePersist(id: NoteId): void { deleteNotePersist", "description": "Removes a note by its id.", "scope": "", "scopeKind": ""}, {"name": "export function syncReplaceAll(notes: Note[]): void { syncReplaceAll", "description": "Replaces the entire notes storage with a provided list of notes.", "scope": "", "scopeKind": ""}, {"name": "export function syncUpsert(note: Note): void { syncUpsert", "description": "Upserts a single note into storage.", "scope": "", "scopeKind": ""}, {"name": "export function syncDelete(id: NoteId): void { syncDelete", "description": "Deletes a note by its id from storage.", "scope": "", "scopeKind": ""}], "calls": ["localStorage.getItem", "localStorage.setItem", "JSON.parse", "JSON.stringify", "createNote", "nowIso", "globalThis.crypto?.randomUUID", "Array.prototype.findIndex", "Array.prototype.slice", "Array.prototype.find", "Array.prototype.filter"], "search-terms": ["localStorage-backed notes persistence", "Note normalization", "createNotePersist", "updateNotePersist", "deleteNotePersist", "syncReplaceAll", "syncUpsert"], "state": 2, "file_id": 28, "knowledge_revision": 104, "git_revision": "", "ctags": [{"_type": "tag", "name": "PersistAPI", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export type PersistAPI = typeof persist;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "STORAGE_KEY", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^const STORAGE_KEY = \"notes_app:data\";$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const all = readAll();$/", "language": "TypeScript", "kind": "constant", "scope": "createNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const all = readAll();$/", "language": "TypeScript", "kind": "constant", "scope": "deleteNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const all = readAll();$/", "language": "TypeScript", "kind": "constant", "scope": "getNote", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const all = readAll();$/", "language": "TypeScript", "kind": "constant", "scope": "syncUpsert", "scopeKind": "function"}, {"_type": "tag", "name": "all", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const all = readAll();$/", "language": "TypeScript", "kind": "constant", "scope": "updateNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "c", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const c = (globalThis as any)?.crypto;$/", "language": "TypeScript", "kind": "constant", "scope": "genId", "scopeKind": "function"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^    content: input.content,$/", "language": "TypeScript", "kind": "constant", "scope": "updateNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const content = typeof v.content === \"string\" ? v.content : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "createNote", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  createNote: createNotePersist,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "createNotePersist", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function createNotePersist(input: NewNoteInput): Note {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "createdAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const createdAt = typeof v.createdAt === \"string\" ? v.createdAt : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "deleteNote", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  deleteNote: deleteNotePersist,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "deleteNotePersist", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function deleteNotePersist(id: NoteId): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const existing = all.find((n) => n.id === input.id);$/", "language": "TypeScript", "kind": "constant", "scope": "updateNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "genId", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^function genId(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getNote", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  getNote,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "getNote", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function getNote(id: NoteId): Note | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const id = genId();$/", "language": "TypeScript", "kind": "constant", "scope": "createNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const id = typeof v.id === \"string\" ? v.id : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const idx = list.findIndex((n) => n.id === note.id);$/", "language": "TypeScript", "kind": "constant", "scope": "upsert", "scopeKind": "function"}, {"_type": "tag", "name": "listNotes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function listNotes(): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "next", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const next = list.slice();$/", "language": "TypeScript", "kind": "constant", "scope": "upsert", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeNote", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^function normalizeNote(v: any): Note | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const note = createNote({ id, title: input.title, content: input.content });$/", "language": "TypeScript", "kind": "constant", "scope": "createNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^    const parsed = JSON.parse(raw);$/", "language": "TypeScript", "kind": "constant", "scope": "readAll", "scopeKind": "function"}, {"_type": "tag", "name": "persist", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export const persist = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^    const raw = localStorage.getItem(STORAGE_KEY);$/", "language": "TypeScript", "kind": "constant", "scope": "readAll", "scopeKind": "function"}, {"_type": "tag", "name": "readAll", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^function readAll(): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "removeById", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^function removeById(list: Note[], id: string): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "syncDelete", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  syncDelete,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "syncDelete", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function syncDelete(id: NoteId): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "syncReplaceAll", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  syncReplaceAll,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "syncReplaceAll", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function syncReplaceAll(notes: Note[]): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "syncUpsert", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  syncUpsert,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "syncUpsert", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function syncUpsert(note: Note): void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^    title: input.title,$/", "language": "TypeScript", "kind": "constant", "scope": "updateNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const title = typeof v.title === \"string\" ? v.title : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "updateNote", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  updateNote: updateNotePersist,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updateNotePersist", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^export function updateNotePersist(input: UpdateNoteInput): Note {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const updated: Note = {$/", "language": "TypeScript", "kind": "constant", "scope": "updateNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "updatedAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^    updatedAt: nowIso(),$/", "language": "TypeScript", "kind": "constant", "scope": "updateNotePersist", "scopeKind": "function"}, {"_type": "tag", "name": "updatedAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const updatedAt = typeof v.updatedAt === \"string\" ? v.updatedAt : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "upsert", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^function upsert(list: Note[], note: Note): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const content = typeof v.content === \"string\" ? v.content : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const createdAt = typeof v.createdAt === \"string\" ? v.createdAt : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const id = typeof v.id === \"string\" ? v.id : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const title = typeof v.title === \"string\" ? v.title : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^  const updatedAt = typeof v.updatedAt === \"string\" ? v.updatedAt : null;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeNote", "scopeKind": "function"}, {"_type": "tag", "name": "writeAll", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37321-37373/notes_frontend/src/lib/persist.ts", "pattern": "/^function writeAll(list: Note[]): void {$/", "language": "TypeScript", "kind": "function"}], "hash": "1a184a09ea8096419a0802d2b2870d47", "format-version": 4, "code-base-name": "notes_frontend", "filename": "notes_frontend/src/lib/persist.ts", "revision_history": [{"104": ""}]}